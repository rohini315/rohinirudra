YUI.add("notification-event-follower-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-added-to-gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},gallery:{},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-people-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},personTagged:{isModel:!0},tagger:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-tag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-photo-comment-mention-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-photo-group-invite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},group:{id:"",name:""},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-group-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-note-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-share-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-group-reply-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{},replyId:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("notification-event-flickrmail-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},mail:{},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("flickr-notifications-markread-updater",function(e,t){"use strict";function n(n,r){return r.callAPI("flickr.notifications.markread",n).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-notifications-markread"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-activity-getNotificationsCount-fetcher",function(e,t){"use strict";function n(e,t,n){var r=e.apiResponse,i=e.personNotifsModelRegistry;return i.setValue(n.id,"unseenNotificationCount",r.activity.count),r.activity.count}function r(n,r){var i=this;return e.FlickrPromise({apiResponse:r.callAPI("flickr.activity.getNotificationsCount",n),personNotifsModelRegistry:r.getModelRegistry("person-notifications-models")}).then(function(e){return i._processResponse(e,r,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-activity-getNotificationsCount"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:["person-notifications-models","api-helper"]});
YUI.add("flickr-activity-muteObject-updater",function(e,t){"use strict";function n(n,r){var i=n;return r.callAPI("flickr.activity.muteObjectByType",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-activity-muteObject"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-activity-unmuteObject-updater",function(e,t){"use strict";function n(n,r){var i=n;return r.callAPI("flickr.activity.unmuteObjectByType",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-activity-unmuteObject"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("person-notifications-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},readUnseenNotificationCount:function(t,n){return e.ModelFetchers["flickr-activity-getNotificationsCount"].run(t,n)},updateMutedObjects:function(t,n){return e.ModelUpdaters["flickr-activity-muteObject"].run(t,n)},updateUnmutedObjects:function(t,n){return e.ModelUpdaters["flickr-activity-unmuteObject"].run(t,n)}},remoteReadUnseenNotificationCount:function(e,t,n){return this.setValue(e,"unseenLastFetchedTimestamp",Date.now()),this.remote.readUnseenNotificationCount(t,n)},remoteUpdateMutedObjects:function(e,t,n){var r=this;return this.remote.updateMutedObjects(t,n).then(function(t){return r.setValue(e,"muteChanged",!0),t})},remoteUpdateUnmutedObjects:function(e,t,n){var r=this;return this.remote.updateUnmutedObjects(t,n).then(function(t){return r.setValue(e,"muteChanged",!0),t})},attributes:{id:{setter:function(e){return e||this.appContext.getViewer().nsid}},unseenNotificationCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},unreadFlickrMailCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},unseenLastFetchedTimestamp:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},muteChanged:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},notifications:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-activity-recentByType"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher","flickr-notifications-markread-updater","flickr-people-getInfo-fetcher","flickr-activity-getNotificationsCount-fetcher","flickr-activity-muteObject-updater","flickr-activity-unmuteObject-updater","attribute-helpers"]});
YUI.add("flickr-activity-recentByType-fetcher",function(e,t){"use strict";function n(t){var n={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||30,count:30,page:t.page||1,per_object:50},r;return r=e.merge(n,t.apiParams||{}),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(r),r}function r(t,n,r,i){var s=t.apiResponse,o=t.notificationModelRegistry,u=t.notificationsModelRegistry,a=t.photoModelRegistry,f=t.personModelRegistry,l=t.contactModelRegistry,c=t.groupModelRegistry,h=t.personRelationshipModelRegistry,p=t.photoEngagementModelRegistry,d=t.photoStatsRegistry,v=t.discussionModelRegistry,m=t.galleryModelRegistry,g=t.flickrMailModelRegistry,y,b=[],w,E;return y={fave:t.faveEventModelRegistry,comment:t.commentEventModelRegistry,contacted:t.followerEventModelRegistry,gallery:t.addedToGalleryEventModelRegistry,tag:t.tagEventModelRegistry,people:t.peopleEventModelRegistry,photo_comment_mention:t.photoCommentMentionNotifRegisty,group_invite:t.photoGroupInviteNotifRegistry,group_user_invite:t.groupNotifModelRegistry,note:t.noteEventModelRegistry,share:t.shareEventModelRegistry,reply_reply:t.groupReplyEventModelRegistry,topic_reply:t.groupReplyEventModelRegistry,friend_join:t.friendJoinEventModelRegistry,group_topic_new:t.groupTopicNewEventModelRegistry,flickrmail:t.flickrMailEventModelRegistry},s.items.item.forEach(function(t){var n=t.activity?t.activity.event:[],r,s,u,w;r={objectType:t.type,seen:t.seen===1,id:e.guid(),events:[],isMuted:t.is_muted===1};if(t.type==="photo"){var S=e.clone(t);if(S.title){var x=S.title.content||S.title._content;S.title=x}r.object=e.APIHelper.response.parsePhotos({photos:[S],photoModelRegistry:a,personModelRegistry:f,photoEngagementModelRegistry:p,photoStatsModelRegistry:d}).shift()}else t.type==="person"?(r.object=f.exists(t.id)?f.proxy(t.id):f.add(e.APIHelper.response.parsePerson({nsid:t.user,pathAlias:t.pathAlias,username:t.username,realname:t.realname,isAdFree:t.isAdFree,ispro:t.ispro,datecreate:t.datecreate,iconurls:t.iconurls})),h.exists(t.user)||h.add({id:t.user,pathAlias:t.pathAlias,isContact:t.contact,isFriend:t.friend,isFamily:t.family,isIgnored:t.ignored,isIgnoredBy:t.ignoredby})):t.type==="group"?r.object=c.exists(t.id)?c.proxy(t.id):c.add(c.parseGroupModel(t.id,t.pathAlias,t)):t.type==="discussion"?(u=e.clone(t),u.id=t.group_id,u.title=t.group_name,w=c.exists(t.group_id)?c.proxy(t.group_id):c.add(c.parseGroupModel(t.group_id,t.pathAlias,u)),r.object=v.exists(t.id)?v.proxy(t.id):v.add(v.parseDiscussionModel(t.id,t.pathAlias,t,w))):t.type==="gallery"?r.object=m.addOrUpdate(m.parseGalleryModel(t)):t.type==="flickrmail"&&(r.object=g.addOrUpdate(g.parseFlickrMailModel(t)));n.forEach(function(n){var o,u,a;if(n.type in y){if(n.type==="people")E={},u=e.APIHelper.response.parseContact({nsid:n.person,username:n.personname}),a=e.APIHelper.response.parseContact({nsid:n.user,username:n.realname}),E.personTagged=l.exists(u.id)?l.proxy(u.id):l.add(u),E.tagger=l.exists(a.id)?l.proxy(a.id):l.add(a);else if(n.type==="group_invite")n.name=n.groupName,n.id=n.groupId,n.iconurls=n.group_iconurls,E=c.exists(n.id)?c.proxy(n.id):c.add(c.parseGroupModel(n.groupId,n.pathAlias,n));else{if(n.type==="note"&&!i.flipper.isFlipped("enable-scrappy-notes"))return;n.type==="gallery"?E={id:n.galleryid,title:n.title,url:"/photos/"+n.owner+"/galleries/"+n.galleryid,iconurls:n.gallery_iconurls}:n.type==="flickrmail"&&(E={mail:{id:t.id,title:t.title,url:"/mail/"+t.id},owner:{nsid:t.user,username:t.username,realname:t.realname,iconserver:t.iconserver,iconfarm:t.iconfarm,pathAlias:t.pathalias,iconUrls:t.iconurls}})}o=e.APIHelper.response.parseNotificationsEvents[n.type](n,E),o.owner=l.addOrUpdate(o.owner);if(o.owner.getValue("isMe")&&n.type!=="group_user_invite")return;s=y[n.type].add(o),r.events.push(s)}}),o.exists(r.id)||b.push(o.add(r))}),w={notifications:b},u.exists(n.id)?u.getValue(n.id,"notifications").addPage({page:r.page,perPage:r.per_page,pageContent:b,totalItems:parseInt(s.items.total||0,10)}):u.add(w),b}function i(n,r){var i=this,s="flickr.activity.recentByType",o=this._processParams(n);return(new e.FlickrPromise({apiResponse:r.callAPI(s,o),notificationModelRegistry:r.getModelRegistry("notification-models"),notificationsModelRegistry:r.getModelRegistry("person-notifications-models"),groupInfoModelRegistry:r.getModelRegistry("group-info-models"),groupModelRegistry:r.getModelRegistry("group-models"),personModelRegistry:r.getModelRegistry("person-models"),photoModelRegistry:r.getModelRegistry("photo-models"),contactModelRegistry:r.getModelRegistry("contact-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),personRelationshipModelRegistry:r.getModelRegistry("person-relationship-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models"),discussionModelRegistry:r.getModelRegistry("notification-group-discussion-models"),galleryModelRegistry:r.getModelRegistry("notification-gallery-models"),flickrMailModelRegistry:r.getModelRegistry("notification-flickrmail-models"),faveEventModelRegistry:r.getModelRegistry("notification-event-fave-models"),commentEventModelRegistry:r.getModelRegistry("notification-event-comment-models"),followerEventModelRegistry:r.getModelRegistry("notification-event-follower-models"),addedToGalleryEventModelRegistry:r.getModelRegistry("notification-event-added-to-gallery-models"),tagEventModelRegistry:r.getModelRegistry("notification-event-tag-models"),peopleEventModelRegistry:r.getModelRegistry("notification-event-people-models"),photoCommentMentionNotifRegisty:r.getModelRegistry("notification-event-photo-comment-mention-models"),photoGroupInviteNotifRegistry:r.getModelRegistry("notification-event-photo-group-invite-models"),groupNotifModelRegistry:r.getModelRegistry("notification-event-group-models"),noteEventModelRegistry:r.getModelRegistry("notification-event-note-models"),shareEventModelRegistry:r.getModelRegistry("notification-event-share-models"
),groupReplyEventModelRegistry:r.getModelRegistry("notification-event-group-reply-models"),friendJoinEventModelRegistry:r.getModelRegistry("notification-event-friend-join-models"),groupTopicNewEventModelRegistry:r.getModelRegistry("notification-event-group-topic-new-models"),flickrMailEventModelRegistry:r.getModelRegistry("notification-event-flickrmail-models")})).then(function(e){return i._processResponse(e,n,o,r)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-activity-recentByType"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["notification-models","person-notifications-models","contact-models","photo-models","notification-group-discussion-models","notification-gallery-models","notification-flickrmail-models","notification-event-fave-models","notification-event-comment-models","notification-event-follower-models","notification-event-added-to-gallery-models","notification-event-people-models","notification-event-tag-models","notification-event-photo-comment-mention-models","notification-event-photo-group-invite-models","notification-event-group-models","notification-event-note-models","notification-event-share-models","notification-event-group-reply-models","notification-event-flickrmail-models"]});
YUI.add("notification-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){var n=e.ListFetchers["flickr-activity-recentByType"].run(t,this.appContext);return n}},attributes:{id:{setter:function(e){return e||this.appContext.getViewer().nsid}},seen:{},objectType:{},object:{isModel:!0},events:{isListProxy:!0},isMuted:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher"]});
